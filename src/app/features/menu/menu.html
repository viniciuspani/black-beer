
<div class="min-h-screen bg-gray-50 flex flex-col">
  <!-- ==================== HEADER ==================== -->
  <header class="header-with-logo bg-amber-600 text-white py-3 sm:py-4 shadow-lg fixed top-0 left-0 right-0 z-40">
    <div class="container mx-auto px-3 sm:px-4">
      <div class="header-content">
        <!-- Logo Black Beer com tooltip "Powered by Black Beer" -->
        <div class="bb-logo-container">
          <img src="/logo_blackBeer-new.png" alt="Black Beer" class="bb-logo-image">
        </div>

        <!-- Logo do Cliente (centralizada) ou Texto padrão -->
        @if (hasClientLogo()) {
          <div class="client-logo-container">
            <img [src]="getClientLogoUrl()"
                 [alt]="getClientCompanyName() || 'Logo da Empresa'"
                 class="client-logo-image">
            @if (getClientCompanyName()) {
              <p class="company-name">{{ getClientCompanyName() }}</p>
            }
          </div>
        } @else {
          <!-- Fallback: Texto padrão quando não há logo -->
          <div class="default-header-text">
            <h1 class="text-xl sm:text-2xl md:text-3xl font-bold">Black Beer</h1>
            <p class="text-amber-200 text-xs sm:text-sm md:text-base">Gestão de Vendas de Cerveja Artesanal</p>
          </div>
        }

        <!-- Informações do Usuário com Dropdown -->
        <div class="user-info-container">
          <div class="user-info-button" #userMenuButton (click)="userMenu.toggle($event)">
            <!-- Avatar -->
            <p-avatar
              [label]="getUserInitials()"
              styleClass="user-avatar"
              shape="circle"
              [style]="{'background-color': '#fb923c', 'color': '#ffffff'}">
            </p-avatar>

            <!-- Informações do Usuário (Desktop) -->
            <div class="user-details">
              <span class="user-name">{{ getUserDisplayName() }}</span>
              <span class="user-role">{{ getUserRoleLabel() }}</span>
            </div>

            <!-- Ícone de dropdown -->
            <i class="pi pi-chevron-down user-dropdown-icon"></i>
          </div>

          <!-- Dropdown Menu -->
          <p-menu #userMenu [model]="userMenuItems" [popup]="true" appendTo="body"></p-menu>
        </div>
      </div>
    </div>
  </header>

  <!-- ==================== MAIN CONTENT ==================== -->
  <!-- Padding top para compensar header fixo -->
  <!-- Padding bottom para compensar bottom nav em mobile -->
  <main class="flex-1 w-full px-2 sm:px-4 py-4 sm:py-6 mt-[88px] sm:mt-[96px] mb-[72px] md:mb-0 overflow-y-auto">

    <!-- ==================== DESKTOP TABS (visível apenas em MD+) ==================== -->
    <div class="hidden md:block">
      <p-tabs [(value)]="activeTabDesktop" (onChange)="onTabChange($event)" class="w-full">
        <p-tablist class="w-full">
          <p-tab value="0" (click)="onTabClick(0)">
            <i class="pi pi-shopping-cart"></i>
            <span> Nova Venda</span>
          </p-tab>
          <p-tab value="1" (click)="onTabClick(1)">
            <i class="pi pi-list"></i>
            <span> Comandas</span>
          </p-tab>
          @if (canAccessReports()) {
            <p-tab value="2" (click)="onTabClick(2)">
              <i class="pi pi-chart-bar"></i>
              <span> Relatórios</span>
            </p-tab>
          }
          <p-tab value="3" (click)="onTabClick(3)">
            <i class="pi pi-moon"></i>
            <span> Cervejas</span>
          </p-tab>
          <p-tab value="4" (click)="onTabClick(4)">
            <i class="pi pi-cog"></i>
            <span> Configurações</span>
          </p-tab>
        </p-tablist>
        <p-tabpanels>
          <p-tabpanel value="0">
            <div class="overflow-auto">
              <app-sales-form></app-sales-form>
            </div>
          </p-tabpanel>

          <p-tabpanel value="1">
            <div class="overflow-auto">
              <app-acompanhamento-comandas></app-acompanhamento-comandas>
            </div>
          </p-tabpanel>

          <p-tabpanel value="2">
            <div class="overflow-auto">
              <app-reports-section></app-reports-section>
            </div>
          </p-tabpanel>

          <p-tabpanel value="3">
            <div class="overflow-auto">
              <app-beer-management></app-beer-management>
            </div>
          </p-tabpanel>

          <p-tabpanel value="4">
            <div class="overflow-auto">
              <!-- Sub-abas de Configurações -->
              <p-tabs [(value)]="activeSettingsTabDesktop" (onChange)="onSettingsTabChange($event)" class="w-full">
                <p-tablist class="w-full">
                  <!-- Aba Empresa: apenas admin -->
                  @if (isAdmin()) {
                    <p-tab value="0" (click)="onSettingsTabClick(0)">
                      <i class="pi pi-shopping-bag"></i>
                      <span> Empresa</span>
                    </p-tab>
                  }
                  <!-- Aba Vendas: admin e gestor -->
                  @if (canManageUsers()) {
                    <p-tab value="1" (click)="onSettingsTabClick(1)">
                      <i class="pi pi-shopping-cart"></i>
                      <span> Vendas</span>
                    </p-tab>
                  }
                  <!-- Aba Admin: admin e gestor -->
                  @if (canManageUsers()) {
                    <p-tab value="2" (click)="onSettingsTabClick(2)">
                      <i class="pi pi-shield"></i>
                      <span> Admin</span>
                    </p-tab>
                  }
                  <!-- Aba Eventos: admin e gestor -->
                  @if (canManageUsers()) {
                    <p-tab value="3" (click)="onSettingsTabClick(3)">
                      <i class="pi pi-calendar"></i>
                      <span> Eventos</span>
                    </p-tab>
                  }
                  <!-- Aba Ajuda: todos -->
                  <p-tab value="4" (click)="onSettingsTabClick(4)">
                    <i class="pi pi-question-circle"></i>
                    <span> Ajuda</span>
                  </p-tab>
                  <!-- Aba Usuario: admin e gestor -->
                  @if (canManageUsers()) {
                    <p-tab value="5" (click)="onSettingsTabClick(5)">
                      <i class="pi pi-user"></i>
                      <span> Usuario</span>
                    </p-tab>
                  }
                  <!-- Aba Empresas: apenas admin -->
                  @if (isAdmin()) {
                    <p-tab value="6" (click)="onSettingsTabClick(6)">
                      <i class="pi pi-building"></i>
                      <span> Empresas</span>
                    </p-tab>
                  }
                </p-tablist>

                <p-tabpanels>
                  <p-tabpanel value="0">
                    <app-settings-business></app-settings-business>
                  </p-tabpanel>
                  <p-tabpanel value="1">
                    <app-settings-sales></app-settings-sales>
                  </p-tabpanel>
                  <p-tabpanel value="2">
                    <app-settings-admin></app-settings-admin>
                  </p-tabpanel>
                  <p-tabpanel value="3">
                    <app-event-management></app-event-management>
                  </p-tabpanel>
                  <p-tabpanel value="4">
                    <app-help></app-help>
                  </p-tabpanel>
                  <p-tabpanel value="5">
                    <app-settings-user></app-settings-user>
                  </p-tabpanel>
                  <p-tabpanel value="6">
                    <app-settings-business-admin></app-settings-business-admin>
                  </p-tabpanel>
                </p-tabpanels>
              </p-tabs>
            </div>
          </p-tabpanel>
        </p-tabpanels>
      </p-tabs>
    </div>

    <!-- ==================== MOBILE CONTENT (visível apenas em <MD) ==================== -->
    <div class="md:hidden">
      <!-- Content baseado na aba ativa -->
      @switch (activeTabMobile()) {
        @case (0) {
          <app-sales-form></app-sales-form>
        }
        @case (1) {
          <app-acompanhamento-comandas></app-acompanhamento-comandas>
        }
        @case (2) {
          <app-reports-section></app-reports-section>
        }
        @case (3) {
          <app-beer-management></app-beer-management>
        }
        @case (4) {
          <!-- Sub-abas de Configurações para Mobile -->
          <div class="flex flex-col gap-3">
            <!-- Botões de Sub-navegação -->
            <div class="bg-white rounded-lg shadow-sm p-2 flex gap-2 overflow-x-auto">
              <!-- Aba Empresa: apenas admin -->
              @if (isAdmin()) {
                <button
                  type="button"
                  (click)="setActiveSettingsTab(0)"
                  class="flex-1 py-2 px-3 rounded-md transition-all duration-200 flex items-center justify-center gap-2 text-sm font-medium whitespace-nowrap"
                  [class.bg-amber-600]="activeSettingsTab() === 0"
                  [class.text-white]="activeSettingsTab() === 0"
                  [class.bg-gray-100]="activeSettingsTab() !== 0"
                  [class.text-gray-700]="activeSettingsTab() !== 0">
                  <i class="pi pi-shopping-bag"></i>
                  <span>Empresa</span>
                </button>
              }
              <!-- Aba Vendas: admin e gestor -->
              @if (canManageUsers()) {
                <button
                  type="button"
                  (click)="setActiveSettingsTab(1)"
                  class="flex-1 py-2 px-3 rounded-md transition-all duration-200 flex items-center justify-center gap-2 text-sm font-medium whitespace-nowrap"
                  [class.bg-amber-600]="activeSettingsTab() === 1"
                  [class.text-white]="activeSettingsTab() === 1"
                  [class.bg-gray-100]="activeSettingsTab() !== 1"
                  [class.text-gray-700]="activeSettingsTab() !== 1">
                  <i class="pi pi-shopping-cart"></i>
                  <span>Vendas</span>
                </button>
              }
              <!-- Aba Admin: admin e gestor -->
              @if (canManageUsers()) {
                <button
                  type="button"
                  (click)="setActiveSettingsTab(2)"
                  class="flex-1 py-2 px-3 rounded-md transition-all duration-200 flex items-center justify-center gap-2 text-sm font-medium whitespace-nowrap"
                  [class.bg-amber-600]="activeSettingsTab() === 2"
                  [class.text-white]="activeSettingsTab() === 2"
                  [class.bg-gray-100]="activeSettingsTab() !== 2"
                  [class.text-gray-700]="activeSettingsTab() !== 2">
                  <i class="pi pi-shield"></i>
                  <span>Admin</span>
                </button>
              }
              <!-- Aba Eventos: admin e gestor -->
              @if (canManageUsers()) {
                <button
                  type="button"
                  (click)="setActiveSettingsTab(3)"
                  class="flex-1 py-2 px-3 rounded-md transition-all duration-200 flex items-center justify-center gap-2 text-sm font-medium whitespace-nowrap"
                  [class.bg-amber-600]="activeSettingsTab() === 3"
                  [class.text-white]="activeSettingsTab() === 3"
                  [class.bg-gray-100]="activeSettingsTab() !== 3"
                  [class.text-gray-700]="activeSettingsTab() !== 3">
                  <i class="pi pi-calendar"></i>
                  <span>Eventos</span>
                </button>
              }
              <!-- Aba Ajuda: todos -->
              <button
                type="button"
                (click)="setActiveSettingsTab(4)"
                class="flex-1 py-2 px-3 rounded-md transition-all duration-200 flex items-center justify-center gap-2 text-sm font-medium whitespace-nowrap"
                [class.bg-amber-600]="activeSettingsTab() === 4"
                [class.text-white]="activeSettingsTab() === 4"
                [class.bg-gray-100]="activeSettingsTab() !== 4"
                [class.text-gray-700]="activeSettingsTab() !== 4">
                <i class="pi pi-question-circle"></i>
                <span>Ajuda</span>
              </button>
              <!-- Aba Usuario: admin e gestor -->
              @if (canManageUsers()) {
                <button
                  type="button"
                  (click)="setActiveSettingsTab(5)"
                  class="flex-1 py-2 px-3 rounded-md transition-all duration-200 flex items-center justify-center gap-2 text-sm font-medium whitespace-nowrap"
                  [class.bg-amber-600]="activeSettingsTab() === 5"
                  [class.text-white]="activeSettingsTab() === 5"
                  [class.bg-gray-100]="activeSettingsTab() !== 5"
                  [class.text-gray-700]="activeSettingsTab() !== 5">
                  <i class="pi pi-user"></i>
                  <span>Usuario</span>
                </button>
              }
              <!-- Aba Empresas: apenas admin -->
              @if (isAdmin()) {
                <button
                  type="button"
                  (click)="setActiveSettingsTab(6)"
                  class="flex-1 py-2 px-3 rounded-md transition-all duration-200 flex items-center justify-center gap-2 text-sm font-medium whitespace-nowrap"
                  [class.bg-amber-600]="activeSettingsTab() === 6"
                  [class.text-white]="activeSettingsTab() === 6"
                  [class.bg-gray-100]="activeSettingsTab() !== 6"
                  [class.text-gray-700]="activeSettingsTab() !== 6">
                  <i class="pi pi-building"></i>
                  <span>Empresas</span>
                </button>
              }
            </div>

            <!-- Conteúdo das Sub-abas -->
            @switch (activeSettingsTab()) {
              @case (0) {
                <app-settings-business></app-settings-business>
              }
              @case (1) {
                <app-settings-sales></app-settings-sales>
              }
              @case (2) {
                <app-settings-admin></app-settings-admin>
              }
              @case (3) {
                <app-event-management></app-event-management>
              }
              @case (4) {
                <app-help></app-help>
              }
              @case (5) {
                <app-settings-user></app-settings-user>
              }
              @case (6) {
                <app-settings-business-admin></app-settings-business-admin>
              }
            }
          </div>
        }
      }
    </div>
  </main>

  <!-- ==================== BOTTOM NAVIGATION (apenas mobile) ==================== -->
  <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-200 shadow-2xl z-50">
    <div class="grid h-[72px]" [class.grid-cols-5]="canAccessReports()" [class.grid-cols-4]="!canAccessReports()">

      <!-- Tab: Nova Venda -->
      <button
        type="button"
        (click)="setActiveTabMobile(0)"
        class="flex flex-col items-center justify-center gap-1 transition-all duration-300 active:scale-95"
        [class.text-amber-600]="activeTabMobile() === 0"
        [class.text-gray-500]="activeTabMobile() !== 0"
        [class.bg-amber-50]="activeTabMobile() === 0"
        aria-label="Nova Venda">
        <i class="pi pi-shopping-cart text-2xl"
           [class.scale-110]="activeTabMobile() === 0"></i>
        <span class="text-xs font-medium"
              [class.font-bold]="activeTabMobile() === 0">Venda</span>
        @if (activeTabMobile() === 0) {
          <div class="absolute bottom-0 left-0 right-0 h-1 bg-amber-600 rounded-t-full"></div>
        }
      </button>

      <!-- Tab: Comandas -->
      <button
        type="button"
        (click)="setActiveTabMobile(1)"
        class="flex flex-col items-center justify-center gap-1 transition-all duration-300 active:scale-95"
        [class.text-amber-600]="activeTabMobile() === 1"
        [class.text-gray-500]="activeTabMobile() !== 1"
        [class.bg-amber-50]="activeTabMobile() === 1"
        aria-label="Comandas">
        <i class="pi pi-list text-2xl"
           [class.scale-110]="activeTabMobile() === 1"></i>
        <span class="text-xs font-medium"
              [class.font-bold]="activeTabMobile() === 1">Comandas</span>
        @if (activeTabMobile() === 1) {
          <div class="absolute bottom-0 left-0 right-0 h-1 bg-amber-600 rounded-t-full"></div>
        }
      </button>

      <!-- Tab: Relatórios (apenas admin e gestor) -->
      @if (canAccessReports()) {
        <button
          type="button"
          (click)="setActiveTabMobile(2)"
          class="flex flex-col items-center justify-center gap-1 transition-all duration-300 active:scale-95"
          [class.text-amber-600]="activeTabMobile() === 2"
          [class.text-gray-500]="activeTabMobile() !== 2"
          [class.bg-amber-50]="activeTabMobile() === 2"
          aria-label="Relatórios">
          <i class="pi pi-chart-bar text-2xl"
             [class.scale-110]="activeTabMobile() === 2"></i>
          <span class="text-xs font-medium"
                [class.font-bold]="activeTabMobile() === 2">Relatórios</span>
          @if (activeTabMobile() === 2) {
            <div class="absolute bottom-0 left-0 right-0 h-1 bg-amber-600 rounded-t-full"></div>
          }
        </button>
      }

      <!-- Tab: Cervejas -->
      <button
        type="button"
        (click)="setActiveTabMobile(3)"
        class="flex flex-col items-center justify-center gap-1 transition-all duration-300 active:scale-95"
        [class.text-amber-600]="activeTabMobile() === 3"
        [class.text-gray-500]="activeTabMobile() !== 3"
        [class.bg-amber-50]="activeTabMobile() === 3"
        aria-label="Cervejas">
        <i class="pi pi-moon text-2xl"
           [class.scale-110]="activeTabMobile() === 3"></i>
        <span class="text-xs font-medium"
              [class.font-bold]="activeTabMobile() === 3">Cervejas</span>
        @if (activeTabMobile() === 3) {
          <div class="absolute bottom-0 left-0 right-0 h-1 bg-amber-600 rounded-t-full"></div>
        }
      </button>

      <!-- Tab: Configurações -->
      <button
        type="button"
        (click)="setActiveTabMobile(4)"
        class="flex flex-col items-center justify-center gap-1 transition-all duration-300 active:scale-95"
        [class.text-amber-600]="activeTabMobile() === 4"
        [class.text-gray-500]="activeTabMobile() !== 4"
        [class.bg-amber-50]="activeTabMobile() === 4"
        aria-label="Configurações">
        <i class="pi pi-cog text-2xl"
           [class.scale-110]="activeTabMobile() === 4"></i>
        <span class="text-xs font-medium"
              [class.font-bold]="activeTabMobile() === 4">Config</span>
        @if (activeTabMobile() === 4) {
          <div class="absolute bottom-0 left-0 right-0 h-1 bg-amber-600 rounded-t-full"></div>
        }
      </button>

    </div>
  </nav>

  <!-- ==================== FOOTER (apenas desktop) ==================== -->
  <footer class="hidden md:block bg-gray-200 py-3 sm:py-4 mt-8 sm:mt-12">
    <div class="container mx-auto px-2 sm:px-4 text-center text-gray-600 text-xs sm:text-base">
      <p>© 2026 Black Beer</p>
    </div>
  </footer>
</div>
